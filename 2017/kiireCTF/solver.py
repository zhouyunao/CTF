from Crypto.Util.number import *
from Crypto.Random.random import randint
import gmpy
import os
from known import n,enc1,enc2,enc3
import math

# e,enc1,enc2,enc3,n
e = 4919

# s 10000-->11111?
s = [11,13,17]
n_s = 0

# ----------a,b------------
# enc1 = (b**a)(modn**(s+1))
def test():
    c = enc1 % n
    print c
    b = c
    tmp = enc1 % (n**2)
    print tmp
    a = (tmp - 1)/n
    print a
    for t_s in s:
        if pow(n+1,a,n**(t_s+1)) == enc1:
            n_s = t_s
            print t_s



test()


# m1z0r3{r3l4t3d_m3ss4g3_4tt4ck_1s_v3ry_imp0rt4nt!!}S\xf4f\xe0z\x93\x13+\xf4\xe0\xba\xe2J\x83\xff\xd4\x80@a\x1e\x8c\x1a\xdd\x8f\xd1\tt\x13Z\xf6Q\x9a\x99\xf3\xd4\xf6J1~\xf2+\x86\xe03\x8e\x8f\x92\xc3\x92\xa0G$\x88\xb9U\x9d\xd5E\x8dLQ\x12\x86\x0f\x85G\xc2\x03\xca\rF\xe0=\xdc\xc4_\x06\'\xfcP\x08\xd6\xf0g_\xd79\xb0@B\x9d\xd2\x98\x8ao`^\xb4;A\xf0\x8b\x90\x91\xe3\x98\x9d\x13R\x1ec\x86\x10\x9dW\xb3\x13T^\xd4zx\xedOl\x16h\x9dW\x16Q\x08\xf3\xc9\xd3\x8d\t\xff\x1e\x16\xbb^\xefS\x9f\xaf\x03\x83M\xec\r\xb2lR\x89\xd0\x8bX\xbbw\x18\x06[\x0ebc\x93I\x1a\x0e\xacik%\x91-\x94zP\x14\xf5"\xc3C\xa4?\xc7\x0b\x1em\xebu\xcbXd~Y\xb4\x91\xa0\x14\x94\x7fA'

# # coppersmiths_short_pad_attack.sage



# def related_message_attack(c1, c2, diff, e, n):
#     PRx.<x> = PolynomialRing(Zmod(n))
#     g1 = x^e - c1
#     g2 = (x+diff)^e - c2
#
#     def gcd(g1, g2):
#         while g2:
#             g1, g2 = g2, g1 % g2
#         return g1.monic()
#
#     return -gcd(g1, g2)[0]
#
#
# if __name__ == '__main__':
#     n = 17936583793521668449228524298457855194230669101408919763851365051029325541912323160594135057241912712384021850361223113885817195717118363181415488401858097380286445915819422508709747036442840459095433224101401778236091870169600508193768643238904703606535000004520478941948704927695700844461458088317291675358494001521031976576841936390811337099256638033958221855062600441901559694731407652584356876092962319404426945584534237191055325100380337348787113895678393003137585251133233086915746135673792210246782401052663642883011237531665079959876679796213400972349627247797050808840880000983399088332801591578905051046277
#     e = 4919
#
#
#     # ^^ = bit-wise XOR
#     # http://doc.sagemath.org/html/en/faq/faq-usage.html#how-do-i-use-the-bitwise-xor-operator-in-sage
#
#
#    #  diff = short_pad_attack(c1, c2, e, n)
#     #print "difference of two messages is %d" % diff
#     diff =76971116768797891404680878686551044289271833521094704041365444908537242786753444261302850227360616111878872924507689949366259485691697338110168246928175672274719024341939360939912047915234622248408785680151101089703589723947372238240409512318229771580168061705181906371907059941641754901338079025394952978670
#
#     c2=7070913803891387329863031433956156919484250615163418686701754226975890016964504826594885823484046919735420784661123703865758943308367307363021161059392626477830447917005234093321131624935444372867892205531343966798884418393778045354061402873090880223114595731588909805725837089449299216401075497398783300187199221232838349224981259240725841459518076735101533922085724858975110817801967450732731928790136298873352684712735892259571591468309854642364199643193061176894250465440235927464242837437718963838156955753919046214859765218494779211981010628296063395569615070332116633267991760169951089704951763084427765002469
#     c1=6661233305254662616036261091359688713280596477292664044576628912066057248054668607585866565795040436653165701378145809480389437793147874287623267696058275579456902095585915301848015204936100744336206878034270594265927626069229223002178994815441372360750818552193663460125565591964845664704181125487873859661349766747413621252701609438874464187151486098493259351473811034471111972929472808004564016653177946355552943291676639505649449178406416831247858180764245948291584447236523832813810425302372646334472432182221106093004548379699249834945106903013835577244947835933727333487248088092128901157929231260213988815489
#     m1 = (related_message_attack(c1, c2, diff, e, n)-1)%n
#     print m1
